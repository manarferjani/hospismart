{% extends 'back.html.twig' %}

{% block title %}Tableau de bord - Hospismart{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
    .back-page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }
    .back-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    .back-card {
        border-radius: 15px;
        padding: 22px;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        text-decoration: none;
    }
    .back-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        color: white;
    }
    .back-card.blue   { background: linear-gradient(135deg, #3498db, #2980b9); }
    .back-card.yellow { background: linear-gradient(135deg, #f1c40f, #f39c12); }
    .back-card.cyan   { background: linear-gradient(135deg, #1abc9c, #16a085); }
    .back-card.green  { background: linear-gradient(135deg, #2ecc71, #27ae60); }
    .back-card.red    { background: linear-gradient(135deg, #e74c3c, #c0392b); }
    .back-card.orange { background: linear-gradient(135deg, #e67e22, #d35400); }
    .back-card.dark   { background: linear-gradient(135deg, #34495e, #2c3e50); }
    .back-card.purple { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
    .back-card.teal   { background: linear-gradient(135deg, #00b894, #00cec9); }

    .back-card-value { font-size: 28px; font-weight: 800; line-height: 1; margin-bottom: 5px; }
    .back-card-label { font-size: 13px; opacity: 0.85; font-weight: 500; }
    .back-card-icon  { font-size: 35px; opacity: 0.35; }

    .section-title {
        font-size: 14px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #94a3b8;
        margin: 25px 0 12px 0;
    }

    .quick-links {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 12px;
        margin-bottom: 30px;
    }
    .quick-link {
        background: white;
        border-radius: 12px;
        padding: 16px;
        text-align: center;
        text-decoration: none;
        color: #334155;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        transition: all 0.2s;
        border: 1px solid #f1f5f9;
    }
    .quick-link:hover {
        background: #f0f7ff;
        border-color: #3b82f6;
        color: #1d4ed8;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(59,130,246,0.15);
    }
    .quick-link i { font-size: 22px; margin-bottom: 8px; display: block; }
    .quick-link span { font-size: 13px; font-weight: 600; }
</style>
{% endblock %}

{% block content %}
<div class="back-page-header">
    <div>
        <h1 class="back-page-title" style="font-size:24px; font-weight:800; color:#1e293b;">üìä Tableau de Bord</h1>
        <p style="color:#64748b; margin:0; font-size:14px;">Vue d'ensemble de l'h√¥pital</p>
    </div>
    <div>
        <a href="{{ path('back_office_export_pdf') }}" class="btn btn-sm btn-outline-danger me-2">
            <i class="fas fa-file-pdf"></i> PDF
        </a>
        <a href="{{ path('back_office_export_excel') }}" class="btn btn-sm btn-outline-success">
            <i class="fas fa-file-excel"></i> Excel
        </a>
    </div>
</div>

{# ---- Statistiques Utilisateurs ---- #}
<div class="section-title">üë• Utilisateurs</div>
<div class="back-cards">
    <a href="{{ path('app_dashboard_utilisateurs_list') }}" class="back-card blue">
        <div>
            <div class="back-card-value">{{ totalUsers }}</div>
            <div class="back-card-label">Total Utilisateurs</div>
        </div>
        <div class="back-card-icon">üë§</div>
    </a>
    <a href="{{ path('app_dashboard_utilisateurs_list') }}" class="back-card cyan">
        <div>
            <div class="back-card-value">{{ totalPatients }}</div>
            <div class="back-card-label">Patients</div>
        </div>
        <div class="back-card-icon">üè•</div>
    </a>
    <a href="{{ path('app_medecin_index') }}" class="back-card purple">
        <div>
            <div class="back-card-value">{{ totalMedecins }}</div>
            <div class="back-card-label">M√©decins</div>
        </div>
        <div class="back-card-icon">üë®‚Äç‚öïÔ∏è</div>
    </a>
</div>

{# ---- Statistiques Rendez-vous ---- #}
<div class="section-title">üìÖ Rendez-vous</div>
<div class="back-cards">
    <div class="back-card teal">
        <div>
            <div class="back-card-value">{{ rdvAujourdhui }}</div>
            <div class="back-card-label">RDV Aujourd'hui</div>
        </div>
        <div class="back-card-icon">üìÜ</div>
    </div>
    <div class="back-card yellow">
        <div>
            <div class="back-card-value">{{ rdvEnAttente }}</div>
            <div class="back-card-label">En Attente</div>
        </div>
        <div class="back-card-icon">‚è≥</div>
    </div>
    <div class="back-card dark">
        <div>
            <div class="back-card-value">{{ rdvTotal }}</div>
            <div class="back-card-label">Total RDV</div>
        </div>
        <div class="back-card-icon">üìã</div>
    </div>
</div>

{# ---- Statistiques Consultations & R√©clamations ---- #}
<div class="section-title">üè• Consultations & R√©clamations</div>
<div class="back-cards">
    <div class="back-card blue">
        <div>
            <div class="back-card-value">{{ total_consultations }}</div>
            <div class="back-card-label">Total Consultations</div>
        </div>
        <div class="back-card-icon">üìã</div>
    </div>
    <div class="back-card green">
        <div>
            <div class="back-card-value">{{ taux_reponse }}%</div>
            <div class="back-card-label">Taux de R√©ponse</div>
        </div>
        <div class="back-card-icon">‚úì</div>
    </div>
    <a href="{{ path('back_office_dashboard') }}" class="back-card red">
        <div>
            <div class="back-card-value">{{ reclamationsEnAttente }}</div>
            <div class="back-card-label">R√©clamations en attente</div>
        </div>
        <div class="back-card-icon">‚ö†</div>
    </a>
    <a href="{{ path('back_office_dashboard') }}" class="back-card orange">
        <div>
            <div class="back-card-value">{{ reclamationsTotal }}</div>
            <div class="back-card-label">Total R√©clamations</div>
        </div>
        <div class="back-card-icon">üì£</div>
    </a>
</div>

{# ---- Statistiques Stocks ---- #}
<div class="section-title">üíä Stocks M√©dicaments</div>
<div class="back-cards">
    <a href="{{ path('app_medicament_index') }}" class="back-card orange">
        <div>
            <div class="back-card-value">{{ totalMedicaments }}</div>
            <div class="back-card-label">M√©dicaments</div>
        </div>
        <div class="back-card-icon">üíä</div>
    </a>
    <div class="back-card red">
        <div>
            <div class="back-card-value">{{ stockFaible }}</div>
            <div class="back-card-label">Stocks Faibles</div>
        </div>
        <div class="back-card-icon">‚ö†</div>
    </div>
    <div class="back-card green">
        <div>
            <div class="back-card-value">{{ valeurStockTotal|number_format(0, ',', ' ') }} ‚Ç¨</div>
            <div class="back-card-label">Valeur Totale Stock</div>
        </div>
        <div class="back-card-icon">üí∞</div>
    </div>
</div>

{# ---- Acc√®s Rapides ---- #}
<div class="section-title">‚ö° Acc√®s Rapides</div>
<div class="quick-links">
    <a href="{{ path('app_medecin_index') }}" class="quick-link">
        <i class="fa-solid fa-user-doctor text-primary"></i>
        <span>M√©decins</span>
    </a>
    <a href="{{ path('app_dashboard_utilisateurs_list') }}" class="quick-link">
        <i class="fa-solid fa-users text-info"></i>
        <span>Patients</span>
    </a>
    <a href="{{ path('app_diagnostic_index') }}" class="quick-link">
        <i class="fa-solid fa-stethoscope text-success"></i>
        <span>Diagnostics</span>
    </a>
    <a href="{{ path('app_parametre_vital_index') }}" class="quick-link">
        <i class="fa-solid fa-heart-pulse text-danger"></i>
        <span>Param√®tres Vitaux</span>
    </a>
    <a href="{{ path('app_campagne_index') }}" class="quick-link">
        <i class="fa-solid fa-bullhorn text-warning"></i>
        <span>Campagnes</span>
    </a>
    <a href="{{ path('app_equipement_index') }}" class="quick-link">
        <i class="fa-solid fa-kit-medical text-secondary"></i>
        <span>√âquipements</span>
    </a>
    <a href="{{ path('app_service_index') }}" class="quick-link">
        <i class="fa-solid fa-hospital" style="color:#6f42c1;"></i>
        <span>Services</span>
    </a>
    <a href="{{ path('app_evenement_index') }}" class="quick-link">
        <i class="fa-solid fa-calendar-check text-primary"></i>
        <span>√âv√©nements</span>
    </a>
    <a href="{{ path('back_office_dashboard') }}" class="quick-link">
        <i class="fa-solid fa-circle-exclamation text-danger"></i>
        <span>R√©clamations</span>
    </a>
    <a href="{{ path('app_medicament_index') }}" class="quick-link">
        <i class="fa-solid fa-pills text-warning"></i>
        <span>M√©dicaments</span>
    </a>
</div>

{# ---- Derniers Mouvements de Stock ---- #}
<div class="card shadow-sm border-0 mt-2" style="border-radius: 15px;">
    <div class="card-body">
        <h5 class="card-title mb-4 fw-bold">üì¶ Derniers Mouvements de Stock</h5>
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Date</th>
                        <th>M√©dicament</th>
                        <th>Type</th>
                        <th>Quantit√©</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mouvement in recentMouvements %}
                        <tr>
                            <td>{{ mouvement.dateMouvement|date('d/m/Y H:i') }}</td>
                            <td><strong>{{ mouvement.medicament.nom }}</strong></td>
                            <td>
                                <span class="badge {{ mouvement.type == 'ENTREE' ? 'bg-success' : 'bg-danger' }}">
                                    {{ mouvement.type == 'ENTREE' ? '‚Üë Entr√©e' : '‚Üì Sortie' }}
                                </span>
                            </td>
                            <td>{{ mouvement.quantite }}</td>
                        </tr>
                    {% else %}
                        <tr><td colspan="4" class="text-center text-muted py-3">Aucun mouvement r√©cent</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}