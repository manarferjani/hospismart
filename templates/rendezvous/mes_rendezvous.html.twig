{% extends 'front.html.twig' %}

{% block title %}Mes Rendez-vous{% endblock %}

{% block body %}
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 style="color: #1a1a2e; font-weight: 800;">Mon agenda médical</h1>
        <a href="{{ path('app_medecin_recherche') }}" class="btn btn-primary" style="border-radius: 10px; background: #4178F5;">
            <i class="fas fa-plus me-2"></i>Prendre un nouveau RDV
        </a>
    </div>

    {# Les messages flash sont aussi dans la cloche, mais on peut les garder ici pour confirmation immédiate #}
    {% for message in app.flashes('success') %}
        <div class="alert alert-success border-0 shadow-sm mb-4" style="border-radius: 15px;">
            <i class="fas fa-check-circle me-2"></i>{{ message }}
        </div>
    {% endfor %}

    <div class="row">
        {% for rdv in rendezvous %}
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm border-0 h-100" style="border-radius: 20px; overflow: hidden;">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between">
                            <div>
                                {# LOGIQUE DES BADGES DYNAMIQUES #}
                                <span class="badge mb-2" 
                                      style="padding: 8px 14px; border-radius: 10px; font-weight: 600;
                                      {% if rdv.statut == 'CONFIRME' %}
                                          background: rgba(25, 135, 84, 0.1); color: #198754;
                                      {% elseif rdv.statut == 'REFUSE' %}
                                          background: rgba(220, 53, 69, 0.1); color: #dc3545;
                                      {% else %}
                                          background: rgba(255, 193, 7, 0.15); color: #856404;
                                      {% endif %}">
                                    <i class="fas {% if rdv.statut == 'CONFIRME' %}fa-check-circle{% elseif rdv.statut == 'REFUSE' %}fa-times-circle{% else %}fa-clock{% endif %} me-1"></i>
                                    {% if rdv.statut == 'EN_ATTENTE' %}
                                        En attente (réponse du médecin)
                                    {% else %}
                                        {{ rdv.statut|capitalize }}
                                    {% endif %}
                                </span>

                                <h4 class="mb-1" style="font-weight: 700;">Dr. {{ rdv.medecin.user.nom }} {{ rdv.medecin.user.prenom }}</h4>
                                <p class="text-muted mb-3"><i class="fas fa-certificate me-2"></i>{{ rdv.medecin.specialite }}</p>
                            </div>
                            <div class="text-end">
                                <div style="background: #f8fafc; padding: 10px; border-radius: 12px; border: 1px solid #edf2f7;">
                                    <div style="font-weight: 800; color: #1a1a2e; font-size: 1.2rem;">
                                        {{ rdv.datetime|date('H:i') }}
                                    </div>
                                    <div style="font-size: 0.8rem; color: #64748b; text-transform: uppercase; font-weight: 600;">
                                        {{ rdv.datetime|date('d M Y') }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-3 p-3" style="background: #fdfdfd; border-radius: 12px; border: 1px dashed #e2e8f0;">
                            <small class="text-muted d-block mb-1">Motif de consultation :</small>
                            <p class="mb-0" style="font-style: italic; color: #4a5568;">"{{ rdv.motif|default('Non précisé') }}"</p>
                        </div>

                        {# ACTIONS : On ne permet l'annulation que si ce n'est pas déjà refusé #}
                        <div class="mt-4">
                            {% if rdv.statut in ['EN_ATTENTE', 'CONFIRME'] %}
                                <a href="{{ path('app_rendezvous_annuler', {'id': rdv.id}) }}" 
                                   class="btn btn-outline-danger w-100" 
                                   style="border-radius: 12px; font-weight: 600; transition: 0.3s;"
                                   onclick="return confirm('Êtes-vous sûr de vouloir annuler ce rendez-vous ?')">
                                    <i class="fas fa-calendar-times me-2"></i>Annuler le rendez-vous
                                </a>
                            {% elseif rdv.statut == 'REFUSE' %}
                                <button class="btn btn-light w-100 disabled" style="border-radius: 12px; color: #a0aec0;">
                                    Indisponible
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="col-12 text-center py-5">
                <img src="https://cdn-icons-png.flaticon.com/512/2373/2373539.png" style="width: 100px; opacity: 0.2;" class="mb-4">
                <p class="text-muted" style="font-size: 1.2rem;">Vous n'avez aucun rendez-vous prévu pour le moment.</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}