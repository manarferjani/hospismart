{% extends 'base_back.html.twig' %}

{% block title %}Mon compte - Hospismart{% endblock %}

{% block content %}
<div class="back-page-header">
    <h1 class="back-page-title">üë§ Mon compte</h1>
    <a href="{{ path('app_dashboard') }}" class="btn" style="background:#95a5a6;color:#fff;">‚Üê Dashboard</a>
</div>

{% if errors %}
    <div class="alert alert-danger" style="padding: 15px; margin-bottom: 20px; background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 4px;">
        <strong>Erreur(s) de validation :</strong>
        <ul style="margin: 10px 0 0 20px;">
            {% for error in errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

<form method="post" action="{{ path('app_compte_edit') }}" class="back-form js-form-validate">
    <input type="hidden" name="_csrf_token" value="{{ csrf_token('compte_edit') }}">
    <div class="back-form-card">
        <h3>Compte</h3>
        <div class="back-form-grid">
            <div class="form-group">
                <label for="nom">Nom d'utilisateur *</label>
                <input type="text" id="nom" name="nom" value="{{ user.nom }}" required data-required-msg="Le nom est obligatoire." data-minlength="3" data-minlength-msg="Le nom doit contenir au moins 3 caract√®res." data-maxlength="180" data-maxlength-msg="Le nom ne doit pas d√©passer 180 caract√®res." maxlength="180">
                <span class="field-error" aria-live="polite"></span>
            </div>
            <div class="form-group">
                <label for="prenom">Pr√©nom *</label>
                <input type="text" id="prenom" name="prenom" value="{{ user.prenom }}" required data-required-msg="Le pr√©nom est obligatoire." data-minlength="2" data-minlength-msg="Le pr√©nom doit contenir au moins 2 caract√®res." data-maxlength="255" data-maxlength-msg="Le pr√©nom ne doit pas d√©passer 255 caract√®res." maxlength="255">
                <span class="field-error" aria-live="polite"></span>
            </div>
            <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" name="email" value="{{ user.email }}" required data-required-msg="L'email est obligatoire." data-email-msg="Email invalide." data-maxlength="255">
                <span class="field-error" aria-live="polite"></span>
            </div>
            <div class="form-group">
                <label for="telephone">T√©l√©phone</label>
                <input type="text" id="telephone" name="telephone" value="{{ user.telephone }}" data-maxlength="20" maxlength="20">
            </div>
            <div class="form-group">
                <label for="password">Nouveau mot de passe (laisser vide pour ne pas changer)</label>
                <input type="password" id="password" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" data-minlength="6" data-minlength-msg="Le mot de passe doit contenir au moins 6 caract√®res.">
            </div>
        </div>
    </div>

    {% if patient %}
    <div class="back-form-card">
        <h3>Profil patient</h3>
        <div class="back-form-grid">
            <div class="form-group">
                <label for="genre">Genre *</label>
                <select id="genre" name="genre" required data-required-msg="Le genre est obligatoire.">
                    <option value="">-- S√©lectionner --</option>
                    <option value="Homme" {{ patient.genre == 'Homme' ? 'selected' : '' }}>Homme</option>
                    <option value="Femme" {{ patient.genre == 'Femme' ? 'selected' : '' }}>Femme</option>
                    <option value="Autre" {{ patient.genre == 'Autre' ? 'selected' : '' }}>Autre</option>
                </select>
                <span class="field-error" aria-live="polite"></span>
            </div>
            <div class="form-group">
                <label for="date_naissance">Date de naissance *</label>
                <input type="date" id="date_naissance" name="date_naissance" value="{{ patient.dateNaissance ? patient.dateNaissance|date('Y-m-d') : '' }}" required data-required-msg="La date de naissance est obligatoire.">
                <span class="field-error" aria-live="polite"></span>
            </div>
            <div class="form-group">
                <label for="groupe_sanguin">Groupe sanguin</label>
                <input type="text" id="groupe_sanguin" name="groupe_sanguin" value="{{ patient.groupeSanguin }}" placeholder="ex: O+">
            </div>
            <div class="form-group" style="grid-column:1/-1;">
                <label for="adresse">Adresse</label>
                <input type="text" id="adresse" name="adresse" value="{{ patient.adresse }}" data-maxlength="1000" maxlength="1000">
            </div>
        </div>
    </div>
    {% endif %}

    {% if medecin %}
    <div class="back-form-card">
        <h3>Profil m√©decin</h3>
        <div class="back-form-grid">
            <div class="form-group">
                <label for="specialite">Sp√©cialit√© *</label>
                <input type="text" id="specialite" name="specialite" value="{{ medecin.specialite }}" required data-required-msg="La sp√©cialit√© est obligatoire." data-minlength="3" data-minlength-msg="La sp√©cialit√© doit contenir au moins 3 caract√®res." data-maxlength="255" data-maxlength-msg="La sp√©cialit√© ne doit pas d√©passer 255 caract√®res." maxlength="255">
                <span class="field-error" aria-live="polite"></span>
            </div>
            <div class="form-group">
                <label for="matricule">Matricule *</label>
                <input type="text" id="matricule" name="matricule" value="{{ medecin.matricule }}" required data-required-msg="Le matricule est obligatoire." data-minlength="3" data-minlength-msg="Le matricule doit contenir au moins 3 caract√®res." data-maxlength="255" data-maxlength-msg="Le matricule ne doit pas d√©passer 255 caract√®res." maxlength="255">
                <span class="field-error" aria-live="polite"></span>
            </div>
            <div class="form-group">
                <label for="medecin_telephone">T√©l√©phone</label>
                <input type="text" id="medecin_telephone" name="medecin_telephone" value="{{ medecin.telephone }}" data-maxlength="255" maxlength="255">
            </div>
            <div class="form-group">
                <label for="service">Service *</label>
                <select id="service" name="service" required data-required-msg="Le service est obligatoire.">
                    <option value="">-- S√©lectionner --</option>
                    {% for s in services %}
                    <option value="{{ s.id }}" {{ medecin.service and medecin.service.id == s.id ? 'selected' : '' }}>{{ s.nom }}</option>
                    {% endfor %}
                </select>
                <span class="field-error" aria-live="polite"></span>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="back-form-actions">
        <button type="submit" class="btn-save">Enregistrer</button>
        <a href="{{ path('app_dashboard') }}" class="btn-cancel">Annuler</a>
    </div>
</form>
{% endblock %}
